% !TeX spellcheck = en_GB
\documentclass{beamer}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[spanish]{babel}
\include{pygments}

\hypersetup{colorlinks=true,urlcolor=cyan,linkbordercolor=red,pdfborderstyle={/S/U/W 1}}

\mode<presentation>
{
  \usetheme{Warsaw}
  \setbeamercovered{transparent}
}

\title{Patrones de integración}
\subtitle{Apache Camel y Spring Integration}
\author[Despegar.com]{Pablo Rochás\\ \texttt{pablo.e.rochas@gmail.com}}
\date[Despegar]{Junio 2014}

\begin{document}
\begin{frame}
\titlepage
\end{frame}

\section{Introducción}
\subsection{La motivación}
\begin{frame}{Integración de sistemas}
¿A qué llamamos integración de sistemas?
\end{frame}

\begin{frame}{La motivación}
Problemas de integración al escribir una aplicación
\begin{itemize}[<+->]
\item Distintas aproximaciones por programador
\item La experiencia de Ant
\item Cambios constantes y deuda técnica
\end{itemize}
\end{frame}

\subsection{Soluciones}
\begin{frame}{Soluciones}
\begin{figure}
\begin{center}
\includegraphics[scale=0.35]{TAPA}

agosto 2004
\end{center}
\end{figure}
\end{frame}

\begin{frame}{Soluciones}
\includegraphics[width= 0.9\linewidth]{camel-spring}
\end{frame}

\section{Ejemplos}
\subsection{mailSender}
\begin{frame}[fragile]{Controller}
\begin{Verbatim}[fontsize=\tiny,commandchars=\\\{\}]
\PY{k+kd}{public} \PY{k+kd}{class} \PY{n+nc}{MailSenderController}
\PY{o}{\PYZob{}}
    \PY{o}{.}\PY{o}{.}\PY{o}{.}
    \PY{k+kd}{private} \PY{k+kd}{final} \PY{n}{MessagingTemplate} \PY{n}{template} \PY{o}{=} \PY{k}{new} \PY{n}{MessagingTemplate}\PY{o}{(}\PY{o}{)}\PY{o}{;}

    \PY{n+nd}{@Autowired}
    \PY{n}{MessageChannel} \PY{n}{sendChannel}\PY{o}{;}
    \PY{o}{.}\PY{o}{.}\PY{o}{.}
    
    \PY{k+kd}{private} \PY{k+kt}{long} \PY{n+nf}{processRequest}\PY{o}{(}\PY{n}{MailRequest} \PY{n}{req}\PY{o}{)}
    \PY{o}{\PYZob{}}
      \PY{c+c1}{// Arma el mail}
      \PY{k+kd}{final} \PY{n}{MimeMessage} \PY{n}{mimeMessage} \PY{o}{=} \PY{n}{mailSender}\PY{o}{.}\PY{n+na}{createMimeMessage}\PY{o}{(}\PY{o}{)}\PY{o}{;}
      \PY{o}{.}\PY{o}{.}\PY{o}{.}
      \PY{n}{Message}\PY{o}{\PYZlt{}}\PY{n}{MimeMessage}\PY{o}{\PYZgt{}} \PY{n}{mailMessage} \PY{o}{=} \PY{n}{MessageBuilder}\PY{o}{.}\PY{n+na}{withPayload}\PY{o}{(}\PY{n}{mimeMessage}\PY{o}{)}
              \PY{o}{.}\PY{n+na}{setHeader}\PY{o}{(}\PY{n}{MailCheckerHeaders}\PY{o}{.}\PY{n+na}{REQUEST\PYZus{}ID}\PY{o}{,} \PY{n}{reqId}\PY{o}{)}
              \PY{o}{.}\PY{n+na}{setHeader}\PY{o}{(}\PY{n}{MailCheckerHeaders}\PY{o}{.}\PY{n+na}{MATCH\PYZus{}TYPE}\PY{o}{,} \PY{l+s}{\PYZdq{}sent\PYZdq{}}\PY{o}{)}
              \PY{o}{.}\PY{n+na}{build}\PY{o}{(}\PY{o}{)}\PY{o}{;}
      \PY{n}{template}\PY{o}{.}\PY{n+na}{send}\PY{o}{(}\PY{n}{sendChannel}\PY{o}{,} \PY{n}{mailMessage}\PY{o}{)}\PY{o}{;}      
    \PY{o}{\PYZcb{}}
\PY{o}{\PYZcb{}}
\end{Verbatim}
\end{frame}

\begin{frame}[fragile]{XML (1)}
\begin{Verbatim}[fontsize=\tiny,commandchars=\\\{\}]
    \PY{n+nt}{\PYZlt{}int:channel} \PY{n+na}{id=}\PY{l+s}{\PYZdq{}requestChannel\PYZdq{}} \PY{n+nt}{/\PYZgt{}}

    \PY{n+nt}{\PYZlt{}int:header\PYZhy{}enricher} \PY{n+na}{input\PYZhy{}channel=}\PY{l+s}{\PYZdq{}requestChannel\PYZdq{}} \PY{n+na}{output\PYZhy{}channel=}\PY{l+s}{\PYZdq{}sendChannel\PYZdq{}}\PY{n+nt}{\PYZgt{}}
        \PY{n+nt}{\PYZlt{}int:header} \PY{n+na}{name=}\PY{l+s}{\PYZdq{}mailchecker\PYZus{}match\PYZus{}type\PYZdq{}} \PY{n+na}{value=}\PY{l+s}{\PYZdq{}sent\PYZdq{}}\PY{n+nt}{/\PYZgt{}}
    \PY{n+nt}{\PYZlt{}/int:header\PYZhy{}enricher\PYZgt{}}
\end{Verbatim}
\end{frame}

% tapa del libro de EIP
% Se edito en agosto 2004
% los frameworks en _tal_ año
% Diferencias entre las implementaciones:
% - Spring mucho mas cercano al libro
% - Camel mas cómodo y flexible para el programador, se ajusta a su manera de programar
% El ejemplo se desarrolla con spring
% no es la panacea
% preambulo ejemplo: endpoint, channel, message
% ejemplo mail sender
% channel adapters destacados
% casos especiales: excepciones, transacciones
% endpoints y/o canales interesantes para destacar (jdbc inbound ch adapter, jpa outbound gateway, etc)
% subscriptions api v3
% wiretap, gateway con java
% conclusiones: no es necesario usar una implementacion, se trata de aprender el lenguaje comun

\begin{frame}{Referencias}
\begin{center}
Sitios \\
\href{http://www.eaipatterns.com/}{Enterprise Integration Patterns} \\
\href{http://camel.apache.org/}{Apache Camel} \\
\href{http://projects.spring.io/spring-integration/}{Spring Integration} \\
Libros \\
\href{https://www.dropbox.com/s/gwa5p1edxpgudcz/Manning.Spring.Integration.in.Action.Sep.2012.pdf}{Spring Integration In Action, Manning 2012}  \\
\href{https://www.dropbox.com/s/zd9uft4ygbclehn/Addison.Wesley.Enterprise.Integration.Patterns.pdf}{Enterprise Integration Patterns, Addison Wesley 2004} \\
\href{https://www.dropbox.com/s/gjfegd85cvih78a/Manning.Camel.in.Action.Dec.2010.pdf}{Apache Camel In Action, Manning 2011}
\end{center}
\end{frame}
\end{document}